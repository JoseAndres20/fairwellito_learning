# üïµÔ∏è Nmap - Reconocimiento Sigiloso (Stealth)

Gu√≠a de comandos Nmap para reconocimiento sin ser detectado f√°cilmente por IDS/IPS.

---

## üìñ ¬øQu√© es Nmap?

**Nmap** (Network Mapper) es la herramienta de escaneo de redes m√°s popular y poderosa del mundo. Permite:

- üîç **Descubrir hosts activos** en una red
- üö™ **Identificar puertos abiertos** y servicios corriendo
- üñ•Ô∏è **Detectar sistemas operativos** y versiones de software
- üõ°Ô∏è **Auditar seguridad** de redes y sistemas
- üïµÔ∏è **Realizar reconocimiento** en pentesting

**Creado por:** Gordon Lyon (Fyodor)  
**Licencia:** Open Source (GPL)  
**Plataformas:** Linux, Windows, macOS

---

### Instalaci√≥n

**Linux (Debian/Ubuntu):**
```bash
sudo apt update
sudo apt install nmap -y
```

**Kali Linux:**
```bash
# Ya viene preinstalado
nmap --version
```

**Verificar instalaci√≥n:**
```bash
nmap -V
```

---

### Sintaxis B√°sica

```bash
nmap [Tipo de Escaneo] [Opciones] [Target]
```

**Ejemplo simple:**
```bash
nmap 192.168.1.1
```

---

## üéØ Objetivo de Esta Gu√≠a

Realizar escaneos de reconocimiento **minimizando las probabilidades de detecci√≥n** por sistemas de seguridad, firewalls o IDS/IPS.

---

## ‚ö†Ô∏è Advertencia Legal

**IMPORTANTE:** Estos comandos solo deben usarse en:
- Entornos de pr√°ctica autorizados (TryHackMe, HackTheBox, laboratorios propios)
- Sistemas donde tengas permiso expl√≠cito por escrito
- **NUNCA** en redes o sistemas sin autorizaci√≥n (es ilegal)

---

## üõ†Ô∏è Comandos Esenciales Stealth

### üî∞ Escaneo B√°sico (Para Comparar)

**Escaneo normal (RUIDOSO - te detectar√°n):**
```bash
nmap 192.168.1.100
```

**Problema:** Completa handshake TCP, genera logs, f√°cil de detectar.

---

### 1. SYN Scan (Escaneo Sigiloso B√°sico)

**El m√°s usado para evadir detecci√≥n:**
```bash
sudo nmap -sS 192.168.1.100
```

**¬øPor qu√© es sigiloso?**
- No completa el handshake TCP (env√≠a SYN, recibe SYN-ACK, pero no env√≠a ACK final)
- Muchos sistemas no lo registran como conexi√≥n completa
- Requiere privilegios root/admin

---

### 2. Escaneo SYN con Timing Lento

**Reducir velocidad para evadir IDS:**
```bash
sudo nmap -sS -T2 192.168.1.100
```

**Niveles de timing:**
- `-T0` (Paranoid): Extremadamente lento, casi indetectable
- `-T1` (Sneaky): Muy lento, evita IDS
- `-T2` (Polite): Lento, reduce carga de red
- `-T3` (Normal): Velocidad por defecto
- `-T4` (Aggressive): R√°pido
- `-T5` (Insane): Muy r√°pido, f√°cil de detectar

---

### 3. Fragmentaci√≥n de Paquetes

**Dividir paquetes para evadir firewalls:**
```bash
sudo nmap -sS -f 192.168.1.100
```

**Con fragmentaci√≥n m√°s agresiva:**
```bash
sudo nmap -sS -f -f 192.168.1.100
```

---

### 4. Decoy Scan (IP Se√±uelo)

**Ocultar tu IP real entre IPs falsas:**
```bash
sudo nmap -sS -D RND:10 192.168.1.100
```

**Especificar IPs se√±uelo manualmente:**
```bash
sudo nmap -sS -D 192.168.1.5,192.168.1.8,ME,192.168.1.12 192.168.1.100
```

- `RND:10` = 10 IPs aleatorias como se√±uelo
- `ME` = Tu IP real (se mezcla con las falsas)

---

### 5. Cambiar Source Port

**Usar un puerto origen espec√≠fico (ej. 53 DNS, 80 HTTP):**
```bash
sudo nmap -sS --source-port 53 192.168.1.100
```

**¬øPor qu√© funciona?**
- Algunos firewalls permiten tr√°fico desde puertos "confiables" (53, 80, 443)

---

### 6. Idle Scan (Zombie Scan)

**El m√°s sigiloso: usar una m√°quina intermedia "zombi":**
```bash
sudo nmap -sI 192.168.1.50 192.168.1.100
```

- `192.168.1.50` = Host "zombi" (debe estar idle)
- `192.168.1.100` = Target real
- **Tu IP nunca aparece en los logs del target**

---

### 7. Desactivar Ping (No Ping)

**Escanear sin hacer ping previo:**
```bash
sudo nmap -sS -Pn 192.168.1.100
```

**√ötil cuando:**
- El firewall bloquea ICMP
- Hosts con ping deshabilitado

---

### 8. Escaneo de Puertos Espec√≠ficos

**Solo escanear puertos clave:**
```bash
sudo nmap -sS -p 22,80,443,3389 192.168.1.100
```

**Top 100 puertos m√°s comunes:**
```bash
sudo nmap -sS --top-ports 100 192.168.1.100
```

---

## üß™ Ejemplo Pr√°ctico Completo

### Escenario: Escanear un servidor web sin ser detectado

**Target:** `10.10.10.50` (servidor web en TryHackMe)

**Paso 1:** Verificar si el host est√° activo (sin ping)
```bash
sudo nmap -sn -Pn 10.10.10.50
```

**Paso 2:** Escaneo sigiloso de puertos web
```bash
sudo nmap -sS -p 80,443,8080,8443 -T2 10.10.10.50
```

**Paso 3:** Detectar versiones (lento para evadir IDS)
```bash
sudo nmap -sS -sV -p 80,443 -T1 --version-intensity 2 10.10.10.50
```

**Paso 4:** Guardar resultados
```bash
sudo nmap -sS -sV -p 80,443 -T1 -oN scan_results.txt 10.10.10.50
```

**Output esperado:**
```
PORT    STATE SERVICE VERSION
80/tcp  open  http    Apache httpd 2.4.41
443/tcp open  ssl/http Apache httpd 2.4.41
```

---

## üé≠ Combinaci√≥n Stealth Avanzada

### Reconocimiento Ultra Sigiloso
```bash
sudo nmap -sS -Pn -f -D RND:5 --source-port 53 -T1 --top-ports 50 192.168.1.100
```

**Explicaci√≥n:**
- `-sS` = SYN scan
- `-Pn` = Sin ping
- `-f` = Fragmentaci√≥n
- `-D RND:5` = 5 IPs se√±uelo aleatorias
- `--source-port 53` = Puerto origen 53 (DNS)
- `-T1` = Timing muy lento
- `--top-ports 50` = Solo 50 puertos m√°s comunes

---

### Escaneo Completo pero Lento
```bash
sudo nmap -sS -sV -O -Pn -T2 --max-retries 2 192.168.1.100
```

**Explicaci√≥n:**
- `-sV` = Detectar versiones de servicios
- `-O` = Detectar sistema operativo
- `--max-retries 2` = Solo 2 reintentos (menos ruido)

---

## üö´ T√©cnicas de Evasi√≥n Adicionales

### 1. Randomizar orden de hosts
```bash
sudo nmap -sS --randomize-hosts 192.168.1.0/24
```

### 2. Agregar datos aleatorios
```bash
sudo nmap -sS --data-length 25 192.168.1.100
```

### 3. Usar MAC address falso (Linux)
```bash
sudo nmap -sS --spoof-mac Apple 192.168.1.100
```

---

## üìä Comparaci√≥n de T√©cnicas

| T√©cnica | Nivel Stealth | Velocidad | Uso Com√∫n |
|---------|---------------|-----------|-----------|
| SYN Scan `-sS` | ‚≠ê‚≠ê‚≠ê | R√°pida | Escaneo base |
| Timing `-T1` | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | Muy lenta | Evasi√≥n IDS |
| Fragmentaci√≥n `-f` | ‚≠ê‚≠ê‚≠ê‚≠ê | Media | Evadir firewalls |
| Decoy `-D` | ‚≠ê‚≠ê‚≠ê‚≠ê | Media | Ocultar IP |
| Idle Scan `-sI` | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | Lenta | Anonimato total |

---

## üîç Detecci√≥n de Escaneos

**Para saber si te detectaron, revisa logs del sistema (en entornos autorizados):**

```bash
# Linux
sudo tail -f /var/log/syslog

# Ver conexiones sospechosas
sudo netstat -antp | grep SYN
```

---

## üìö Recursos Adicionales

- [Nmap Official Docs](https://nmap.org/book/man.html)
- [Nmap Stealth Techniques](https://nmap.org/book/man-bypass-firewalls-ids.html)
- Libro: "Nmap Network Scanning" by Gordon Lyon

---

## üèÅ Checklist Pre-Escaneo

```markdown
- [ ] Tengo autorizaci√≥n escrita para escanear
- [ ] Estoy en un entorno legal (lab, CTF, red propia)
- [ ] S√© qu√© t√©cnica usar seg√∫n el objetivo
- [ ] Tengo documentado el escaneo (fecha, hora, prop√≥sito)
- [ ] Guard√© los resultados en archivo (-oN output.txt)
```

---

**Autor:** Jos√© Andr√©s Acu√±a Rodr√≠guez  
**Categor√≠a:** Herramientas - Reconocimiento  
**√öltima actualizaci√≥n:** Octubre 2025

---

**Recuerda:** El reconocimiento sigiloso es una habilidad, pero debe usarse √©ticamente y con autorizaci√≥n. La responsabilidad es tuya.